<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Test Fully QR</title>
</head>
<body>
  <button onclick="scanQRCode()">Skanuj QR</button>
  <div id="result"></div>

  <script>
    // Initialize bindings once, on page load
    document.addEventListener("DOMContentLoaded", () => {
        if (typeof fully !== "undefined") {
            fully.bind('onQrScanSuccess', 'onScanned("$code");');
            fully.bind('onQrScanCancelled', 'onCancelled();');
            console.log("Bindings set");
        } else {
            alert("Fully interface not available.");
        }
    });

    function scanQRCode() {
        console.log("Starting scan...");
        fully.scanQrCode("Zeskanuj kod", "", -1, 15, true, true, false);
    }

    function onScanned(code) {
        console.log("Scan success: ", code);
        document.getElementById("result").innerText = "Zeskanowano: " + code;

        if (code && code.startsWith("http")) {
            window.location.href = code;
        } else {
            alert("Zeskanowany kod nie jest linkiem: " + code);
        }
    }

    function onCancelled() {
        console.log("Scan cancelled");
        alert("Skanowanie anulowane");
    }
  </script>
</body>
</html>
